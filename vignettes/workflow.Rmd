---
title: "PhantomPurgeR: Vignette"
author: "Rick Farouni"
package: PhantomPurgeR
output: html_notebook
---


```{r, echo=FALSE, results="hide", message=FALSE}
require(knitr)
opts_chunk$set(error=FALSE, message=FALSE, warning=FALSE)
```
```{r}
library(PhantomPurgeR)
```
```{r}
# BiocStyle::html_document
#vignette: >
#  %\VignetteIndexEntry{PhantomPurgeR}
#  %\VignetteEngine{knitr::rmarkdown}
#  %\VignetteEncoding{UTF-8}  
```


```{r}
#samples <- DropletUtils:::sim10xMolInfo(tempfile(),
#                                        nsamples = 4,
#                                        umi.length = 14,
#                                        barcode.length = 8, 
#                                        ngenes = 200, 
#                                        nmolecules = 1000000,
#                                        swap.frac = 0.1,
#                                        ave.read = 10, 
#                                       version = c("3"), 
#                                        return.tab = FALSE)
```
```{r}
names(samples) <- paste0("s", 1:4)
samples
```
 
```{r eval=FALSE, include=FALSE}
input_dir <- file.path("/home/rfarouni/Documents/index_hopping/data/hiseq4000/input")
samples <- get_h5_filenames(input_dir)
samples <- samples[1:4]
```
```{r}
out <- read10xMolInfoSamples(samples, barcode_length = NULL)

out <- join_data(out)

out <- estimate_hopping_rate(out, max_r = NULL)
```


```{r}
out
```


```{r}
dataset_name <- "hiseq4000"
```

```{r}
p_read <- plot_molecules_distributions(out, dataset_name, x_lim=250)
p_read <- plot_grid(p_read$p, 
          p_read$legend,
          ncol=2,
          rel_widths=c(1, 0.1))
p_read
```

```{r}
p_fit <- plot_fit(out, dataset_name, x_lim=100)
p_fit <-plot_grid(p_fit$p,
          p_fit$legend,
          ncol=2,
          rel_widths=c(1, 0.2))
p_fit
```


```{r}
out <- purge_phantoms(out, torc=3, return_readcounts=FALSE, return_discarded=TRUE)
out 
```

```{r}
p_tor <-plot_tor(out, dataset_name)

p_tor <-plot_grid(p_tor$p,
          p_tor$legend,
          ncol=2,
          rel_widths=c(1, 0.2))
p_tor 
```


```{r}
sessionInfo()
```


